
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>SPX期权概览（中文）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background-color: #020617;
      color: #e5e7eb;
      font-size: 18px;
    }

    .page {
      max-width: 840px;
      margin: 0 auto;
    }

    .page-header {
      margin-bottom: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .page-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-title {
      font-size: 26px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .page-subtitle {
      font-size: 13px;
      color: #9ca3af;
    }

    .tagline {
      font-size: 12px;
      color: #9ca3af;
    }

    .metric-change {
      font-size: 11px;
      color: #9ca3af;
      margin-left: 4px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 16px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.25), transparent 55%),
                  #020617;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 14px 16px 16px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.55);
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .symbol {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .symbol-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .as-of {
      font-size: 11px;
      color: #9ca3af;
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 16px;
      margin-top: 6px;
      margin-bottom: 10px;
    }

    .metric {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 12px;
    }

    .metric-label {
      color: #9ca3af;
      font-size: 12px;
    }

    .metric-value {
      font-size: 16px;
      font-variant-numeric: tabular-nums;
    }

    .metric-sub {
      margin-top: 2px;
      font-size: 11px;
      color: #9ca3af;
      font-variant-numeric: tabular-nums;
    }

    .metric-group {
  grid-column: 1 / -1;
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px dashed #1f2937;
  font-size: 12px;
  color: #9ca3af;
  letter-spacing: 0.04em;
}

    /* 数字可点击查看历史 */
    .history-trigger {
      cursor: pointer;
    }

    .history-trigger:hover {
      text-decoration: underline;
      text-decoration-style: dotted;
      background: rgba(148, 163, 184, 0.08);
      border-radius: 6px;
    }

    /* 历史弹窗 */
    .history-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      z-index: 40;
    }

    .history-panel {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      max-width: 880px;
      width: calc(100% - 32px);
      background-color: #020617;
      border-radius: 12px;
      border: 1px solid #4b5563;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.8);
      padding: 12px 16px 16px;
      z-index: 50;
    }

    .history-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .history-panel-title {
      font-size: 14px;
      font-weight: 500;
    }

    .history-panel-subtitle {
      font-size: 11px;
      color: #9ca3af;
    }

    .history-close-btn {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 18px;
      cursor: pointer;
      padding: 2px 6px;
      border-radius: 999px;
      line-height: 1;
    }

    .history-close-btn:hover {
      background-color: #111827;
      color: #e5e7eb;
    }

    .history-panel-content {
      max-height: 260px;
      overflow: auto;
      margin-top: 4px;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .history-table th,
    .history-table td {
      padding: 4px 8px;
      text-align: right;
      border-bottom: 1px solid #111827;
      white-space: nowrap;
    }

    .history-table th:first-child,
    .history-table td:first-child {
      text-align: left;
    }

    .history-table thead {
      position: sticky;
      top: 0;
      background-color: #020617;
    }

    .metric-badge-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .badge {
      display: inline-block;
      padding: 1px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
    }

    .badge-green {
      background-color: #16a34a;
      color: #ecfdf3;
    }

    .badge-yellow {
      background-color: #eab308;
      color: #fefce8;
    }

    .badge-red {
      background-color: #dc2626;
      color: #fef2f2;
    }

    .badge-gray {
      background-color: #4b5563;
      color: #e5e7eb;
    }

    .comment {
      margin-top: 6px;
      font-size: 13px;
      line-height: 1.5;
      color: #d1d5db;
    }

    .disclaimer {
      margin-top: 28px;
      font-size: 22px;
      color: #6b7280;
      border-top: 1px solid #1f2937;
      padding-top: 8px;
    }
    
  </style>
</head>
<body>
  <div class="page">
    <header class="page-header">
      <div class="page-header-top">
        <div>
          <div class="page-title">美股指数期权概览</div>
          <div class="page-subtitle">
            基于期权市场的日终快照（30天平值隐含波动率、10%虚值 Skew、看涨/看跌持仓比）。
          </div>
        </div>
        
      </div>
      <div class="tagline">
        数据日期：2025-12-12
      </div>
    </header>

    <!-- 结论区（SPX） -->
<div class="card" style="margin-bottom:16px; padding:12px 16px;">
  <div class="card-header" style="margin-bottom:8px;">
    <div>
      <div style="font-size:14px; font-weight:600;">结论（SPX）</div>
      <div class="symbol-sub"></div>
    </div>
    <div class="as-of">as of 2025-12-12</div>
  </div>

  <div style="display:flex; flex-direction:column; gap:8px; font-size:13px; line-height:1.55;">
    <div>
      <span class="badge badge-yellow">方向建议</span>
      <span style="margin-left:6px;">尾部需求短端升温：仓位以防守为主；减少隔夜赌方向，等待压力回落再加仓。</span>
    </div>

    <div>
      <span class="badge badge-yellow">市场情绪：中性</span>
      <span style="margin-left:6px;">整体情绪：中性（以 30D ATM IV + 短期压力 + 期限结构综合）。</span>
    </div>

    <div>
      <span class="badge badge-green">风险属性</span>
      <span style="margin-left:6px;">期限结构总体平稳：短期事件与中期风险溢价都不算极端。</span>
    </div>

    <div>
      <span class="badge badge-yellow">尾部保险（WING）</span>
      <span style="margin-left:6px;">翼部带短端压力为正：短期尾部需求在抬升（更偏防守）。</span>
    </div>

    <div style="color:#9ca3af; font-size:12px;">
      提示：ATM 更像‘主线风险/事件’，WING 更像‘尾部保险需求’，两者一起看更稳。
    </div>
  </div>
</div>

    <div class="card-grid">
      
      <section class="card" data-symbol="SPX">
        <div class="card-header">
          <div>
            <div class="symbol">SPX</div>
            <div class="symbol-sub">
              标的收盘价：6,825.09
              
                （日变动 -1.04%）
              
              · 30天ATM IV：12.8%
            </div>
          </div>
          <div class="as-of">快照日期：2025-12-12</div>
        </div>

        <div class="metric-grid">
        <div class="metric-group">主线风险（ATM）</div>
          <!-- 30D ATM IV -->
          <div class="metric">
            <div class="metric-label">30天ATM隐含波动率</div>
            <div class="metric-badge-row">
              <div class="metric-value history-trigger" data-symbol="SPX">
                12.8%
                
                  <span class="metric-change">-0.2 波动点</span>
                
              </div>
              <span class="badge badge-green">偏低</span>
            </div>
            <div class="metric-sub">
              5/10日均：14.0% / 14.3%
            </div>
            <div class="metric-sub">
              解读：风险溢价基准。
            </div>
          </div>


          <!-- Skew：10% OTM Put -->
          <div class="metric">
            <div class="metric-label">Skew：10%虚值看跌 vs ATM</div>
            <div class="metric-badge-row">
              <div class="metric-value history-trigger" data-symbol="SPX">
                +9.9 波动点
              </div>
              <span class="badge badge-red">极端</span>
            </div>
            <div class="metric-sub">
              解读：下行保险，越高=对冲更拥挤，更怕尾部风险。
            </div>

          </div>

          <!-- Skew：10% OTM Call -->
          <div class="metric">
            <div class="metric-label">Skew：10%虚值看涨 vs ATM</div>
            <div class="metric-badge-row">
              <div class="metric-value history-trigger" data-symbol="SPX">
                -0.4 波动点
              </div>
              <span class="badge badge-green">温和</span>
            </div>
            <div class="metric-sub">
              解读：上行弹性，越高=追涨意愿强。
            </div>
          </div>

                    <!-- 期限结构：ATM & WING -->
          <div class="metric">
            <div class="metric-label">期限结构（ATM）：1–30天 vs 31–90天</div>
            <div class="metric-badge-row">
              <div class="metric-value history-trigger"
                   data-symbol="SPX"
                   data-history-type="term">
                13.9% / 14.8%
              </div>
              <span class="badge badge-green">
                +0.9 波动点
              </span>
            </div>
            <div class="metric-sub">
              WING（10–20%）：32.1% / 24.5%
            </div>
            <div class="metric-sub">
              解读：看溢价在哪段，中期更贵=结构性风险；短期更贵=事件定价。
            </div>
          </div>

          <!-- 短期压力指数 -->
          <div class="metric">
  <div class="metric-label">短期压力指数（ATM：1–7 vs 1–30）</div>
  <div class="metric-badge-row">
    <div class="metric-value history-trigger"
         data-symbol="SPX"
         data-history-type="term">
      13.7% / 13.9%
      <span class="metric-change">-0.2 波动点</span>
    </div>
    <span class="badge badge-gray">
      中性
    </span>
  </div>
  <div class="metric-sub">
    解读：短端挤压，为正=短期溢价；为负=压力释放。
  </div>
</div>

          <!-- 资金结构：存量（CPR）vs 增量（成交比） -->
<div class="metric">
  <div class="metric-label">资金结构：存量 vs 增量</div>

  <div class="metric-badge-row">
    <div class="metric-value history-trigger" data-symbol="SPX">
      存量 CPR：0.68（看跌占优）
      
        <span class="metric-change">-0.00</span>
      
    </div>
    <span class="badge badge-yellow">看跌占优</span>
  </div>

  <div class="metric-sub history-trigger" data-symbol="SPX">
    增量 CPR：0.80（平衡）
    
      <span class="metric-change">-0.03</span>
    
    · 成交：2,149,442 / 2,678,875
  </div>
  <div class="metric-sub">
              解读：存量/增量,两者背离时信息量最大。
            </div>
</div>
          
          <div class="metric-group">尾部风险（WING · 10–20%）</div>
          <!-- 期限结构：WING（10–20%）1–30 vs 31–90 -->
<div class="metric">
  <div class="metric-label">期限结构（WING 10–20%）：1–30天 vs 31–90天</div>
  <div class="metric-badge-row">
    <div class="metric-value history-trigger" data-symbol="SPX" data-history-type="term">
      32.1% / 24.5%
      <span class="metric-change">-7.6 波动点</span>
    </div>
    <span class="badge badge-red">
      短端抬升,事件压力
    </span>
  </div>
  <div class="metric-sub">
  解读：尾部保险，近端更贵=短期尾部溢价；中端更贵=中期尾部溢价。
</div>
</div>

<!-- 短期压力指数：WING（10–20%） -->
<div class="metric">
  <div class="metric-label">短期压力（WING 10–20%）：1–7天 vs 1–30天</div>
  <div class="metric-badge-row">
    <div class="metric-value history-trigger" data-symbol="SPX" data-history-type="term">
      36.9% / 32.1%
      <span class="metric-change">+4.9 波动点</span>
    </div>
    <span class="badge badge-yellow">
      短期略紧
    </span>
  </div>
  <div class="metric-sub">
  解读：短端尾部保险，为正=短期尾部需求明显抬升，为负=尾部需求回落。
</div>
</div>
      </section>
      
    </div>

        <div class="disclaimer">
      免责声明：本页面仅用于信息展示和教育目的，不构成任何投资建议或买卖任何证券及衍生品的要约或招揽。
      所有数据为日终数据，可能存在延迟或错误。
    </div>
  </div>

  <!-- 历史弹窗 -->
  <div id="history-backdrop" class="history-backdrop" style="display:none;"></div>
  <div id="history-panel" class="history-panel" style="display:none;">
    <div class="history-panel-header">
      <div>
        <div class="history-panel-title" id="history-title"></div>
        <div class="history-panel-subtitle" id="history-subtitle"></div>
      </div>
      <button id="history-close" class="history-close-btn">&times;</button>
    </div>
    <div class="history-panel-content">
      <table class="history-table">
        <thead>
          <tr>
            <th>日期</th>
            <th>30天ATM IV</th>
            <th>10%虚值看跌 Skew</th>
            <th>10%虚值看涨 Skew</th>
            <th>Call/Put 持仓比</th>
            <th>短期压力(1–7-1–30)</th>
            <th>期限结构斜率(31–90-1–30)</th>
          </tr>
        </thead>
        <tbody id="history-tbody"></tbody>
      </table>
    </div>
  </div>

  <script>
  const HISTORY = {"SPX": [{"date": "2025-11-18", "atm_iv_pct": "18.0%", "skew_down_bp": "+13.5 波动点", "skew_up_bp": "-4.0 波动点", "cpr_brief": "0.63（看跌占优）", "short_term_pressure_bp": "+3.1 波动点", "term_iv_slope_bp": "-3.4 波动点", "term_iv_fw_1_7_pct": "25.9%", "term_iv_1_30_pct": "22.8%", "term_iv_31_90_pct": "19.4%", "term_iv_wing_fw_1_7_pct": "61.5%", "term_iv_wing_1_30_pct": "48.3%", "term_iv_wing_31_90_pct": "28.3%"}, {"date": "2025-11-19", "atm_iv_pct": "25.6%", "skew_down_bp": "+0.8 波动点", "skew_up_bp": "-10.0 波动点", "cpr_brief": "0.66（看跌占优）", "short_term_pressure_bp": "+4.6 波动点", "term_iv_slope_bp": "-3.0 波动点", "term_iv_fw_1_7_pct": "25.7%", "term_iv_1_30_pct": "21.1%", "term_iv_31_90_pct": "18.1%", "term_iv_wing_fw_1_7_pct": "73.4%", "term_iv_wing_1_30_pct": "47.9%", "term_iv_wing_31_90_pct": "28.5%"}, {"date": "2025-11-20", "atm_iv_pct": "23.2%", "skew_down_bp": "+7.6 波动点", "skew_up_bp": "-7.5 波动点", "cpr_brief": "0.65（看跌占优）", "short_term_pressure_bp": "+1.7 波动点", "term_iv_slope_bp": "-0.5 波动点", "term_iv_fw_1_7_pct": "21.5%", "term_iv_1_30_pct": "19.9%", "term_iv_31_90_pct": "19.3%", "term_iv_wing_fw_1_7_pct": "68.9%", "term_iv_wing_1_30_pct": "45.3%", "term_iv_wing_31_90_pct": "28.9%"}, {"date": "2025-11-21", "atm_iv_pct": "13.1%", "skew_down_bp": "+17.0 波动点", "skew_up_bp": "+1.6 波动点", "cpr_brief": "0.65（看跌占优）", "short_term_pressure_bp": "+1.5 波动点", "term_iv_slope_bp": "-0.1 波动点", "term_iv_fw_1_7_pct": "20.1%", "term_iv_1_30_pct": "18.6%", "term_iv_31_90_pct": "18.5%", "term_iv_wing_fw_1_7_pct": "33.5%", "term_iv_wing_1_30_pct": "32.9%", "term_iv_wing_31_90_pct": "28.0%"}, {"date": "2025-11-24", "atm_iv_pct": "17.5%", "skew_down_bp": "+9.5 波动点", "skew_up_bp": "-4.7 波动点", "cpr_brief": "0.66（看跌占优）", "short_term_pressure_bp": "+1.1 波动点", "term_iv_slope_bp": "-0.2 波动点", "term_iv_fw_1_7_pct": "18.9%", "term_iv_1_30_pct": "17.8%", "term_iv_31_90_pct": "17.6%", "term_iv_wing_fw_1_7_pct": "47.9%", "term_iv_wing_1_30_pct": "39.0%", "term_iv_wing_31_90_pct": "27.1%"}, {"date": "2025-11-25", "atm_iv_pct": "15.2%", "skew_down_bp": "+9.4 波动点", "skew_up_bp": "-1.3 波动点", "cpr_brief": "0.67（看跌占优）", "short_term_pressure_bp": "+0.4 波动点", "term_iv_slope_bp": "+0.7 波动点", "term_iv_fw_1_7_pct": "16.4%", "term_iv_1_30_pct": "16.0%", "term_iv_31_90_pct": "16.7%", "term_iv_wing_fw_1_7_pct": "46.9%", "term_iv_wing_1_30_pct": "38.1%", "term_iv_wing_31_90_pct": "25.4%"}, {"date": "2025-11-26", "atm_iv_pct": "14.6%", "skew_down_bp": "+8.8 波动点", "skew_up_bp": "-1.0 波动点", "cpr_brief": "0.63（看跌占优）", "short_term_pressure_bp": "+0.4 波动点", "term_iv_slope_bp": "+0.6 波动点", "term_iv_fw_1_7_pct": "16.2%", "term_iv_1_30_pct": "15.8%", "term_iv_31_90_pct": "16.4%", "term_iv_wing_fw_1_7_pct": "50.1%", "term_iv_wing_1_30_pct": "37.7%", "term_iv_wing_31_90_pct": "24.6%"}, {"date": "2025-11-28", "atm_iv_pct": "13.9%", "skew_down_bp": "+8.1 波动点", "skew_up_bp": "+0.3 波动点", "cpr_brief": "0.67（看跌占优）", "short_term_pressure_bp": "-0.3 波动点", "term_iv_slope_bp": "-0.3 波动点", "term_iv_fw_1_7_pct": "15.9%", "term_iv_1_30_pct": "16.2%", "term_iv_31_90_pct": "15.8%", "term_iv_wing_fw_1_7_pct": "41.7%", "term_iv_wing_1_30_pct": "33.9%", "term_iv_wing_31_90_pct": "24.3%"}, {"date": "2025-12-01", "atm_iv_pct": "15.3%", "skew_down_bp": "+8.1 波动点", "skew_up_bp": "-1.6 波动点", "cpr_brief": "0.68（看跌占优）", "short_term_pressure_bp": "+3.3 波动点", "term_iv_slope_bp": "-2.0 波动点", "term_iv_fw_1_7_pct": "21.7%", "term_iv_1_30_pct": "18.3%", "term_iv_31_90_pct": "16.3%", "term_iv_wing_fw_1_7_pct": "49.3%", "term_iv_wing_1_30_pct": "34.3%", "term_iv_wing_31_90_pct": "24.8%"}, {"date": "2025-12-02", "atm_iv_pct": "15.2%", "skew_down_bp": "+7.8 波动点", "skew_up_bp": "-1.7 波动点", "cpr_brief": "0.68（看跌占优）", "short_term_pressure_bp": "+2.9 波动点", "term_iv_slope_bp": "-1.7 波动点", "term_iv_fw_1_7_pct": "20.7%", "term_iv_1_30_pct": "17.8%", "term_iv_31_90_pct": "16.1%", "term_iv_wing_fw_1_7_pct": "51.4%", "term_iv_wing_1_30_pct": "35.2%", "term_iv_wing_31_90_pct": "25.0%"}, {"date": "2025-12-03", "atm_iv_pct": "14.9%", "skew_down_bp": "+7.4 波动点", "skew_up_bp": "-2.3 波动点", "cpr_brief": "0.68（看跌占优）", "short_term_pressure_bp": "+2.7 波动点", "term_iv_slope_bp": "-1.4 波动点", "term_iv_fw_1_7_pct": "20.1%", "term_iv_1_30_pct": "17.4%", "term_iv_31_90_pct": "16.0%", "term_iv_wing_fw_1_7_pct": "50.0%", "term_iv_wing_1_30_pct": "34.9%", "term_iv_wing_31_90_pct": "24.2%"}, {"date": "2025-12-04", "atm_iv_pct": "13.9%", "skew_down_bp": "+8.6 波动点", "skew_up_bp": "-1.5 波动点", "cpr_brief": "0.69（看跌占优）", "short_term_pressure_bp": "+0.5 波动点", "term_iv_slope_bp": "-0.2 波动点", "term_iv_fw_1_7_pct": "16.4%", "term_iv_1_30_pct": "15.9%", "term_iv_31_90_pct": "15.7%", "term_iv_wing_fw_1_7_pct": "51.0%", "term_iv_wing_1_30_pct": "34.4%", "term_iv_wing_31_90_pct": "23.8%"}, {"date": "2025-12-05", "atm_iv_pct": "13.9%", "skew_down_bp": "+7.1 波动点", "skew_up_bp": "-1.0 波动点", "cpr_brief": "0.72（平衡）", "short_term_pressure_bp": "+1.5 波动点", "term_iv_slope_bp": "-0.6 波动点", "term_iv_fw_1_7_pct": "17.8%", "term_iv_1_30_pct": "16.3%", "term_iv_31_90_pct": "15.7%", "term_iv_wing_fw_1_7_pct": "42.4%", "term_iv_wing_1_30_pct": "33.3%", "term_iv_wing_31_90_pct": "24.3%"}, {"date": "2025-12-08", "atm_iv_pct": "14.6%", "skew_down_bp": "+7.9 波动点", "skew_up_bp": "-1.7 波动点", "cpr_brief": "0.69（看跌占优）", "short_term_pressure_bp": "+3.3 波动点", "term_iv_slope_bp": "-1.7 波动点", "term_iv_fw_1_7_pct": "20.9%", "term_iv_1_30_pct": "17.6%", "term_iv_31_90_pct": "15.9%", "term_iv_wing_fw_1_7_pct": "52.9%", "term_iv_wing_1_30_pct": "36.5%", "term_iv_wing_31_90_pct": "24.9%"}, {"date": "2025-12-09", "atm_iv_pct": "15.1%", "skew_down_bp": "+7.8 波动点", "skew_up_bp": "-2.1 波动点", "cpr_brief": "0.69（看跌占优）", "short_term_pressure_bp": "+3.6 波动点", "term_iv_slope_bp": "-1.8 波动点", "term_iv_fw_1_7_pct": "21.3%", "term_iv_1_30_pct": "17.7%", "term_iv_31_90_pct": "15.9%", "term_iv_wing_fw_1_7_pct": "54.7%", "term_iv_wing_1_30_pct": "37.7%", "term_iv_wing_31_90_pct": "25.1%"}, {"date": "2025-12-10", "atm_iv_pct": "14.7%", "skew_down_bp": "+7.5 波动点", "skew_up_bp": "-1.4 波动点", "cpr_brief": "0.69（看跌占优）", "short_term_pressure_bp": "+4.0 波动点", "term_iv_slope_bp": "-2.2 波动点", "term_iv_fw_1_7_pct": "22.0%", "term_iv_1_30_pct": "18.0%", "term_iv_31_90_pct": "15.8%", "term_iv_wing_fw_1_7_pct": "55.3%", "term_iv_wing_1_30_pct": "37.8%", "term_iv_wing_31_90_pct": "24.7%"}, {"date": "2025-12-11", "atm_iv_pct": "13.0%", "skew_down_bp": "+9.2 波动点", "skew_up_bp": "+0.0 波动点", "cpr_brief": "0.69（看跌占优）", "short_term_pressure_bp": "+1.1 波动点", "term_iv_slope_bp": "-0.3 波动点", "term_iv_fw_1_7_pct": "16.6%", "term_iv_1_30_pct": "15.5%", "term_iv_31_90_pct": "15.2%", "term_iv_wing_fw_1_7_pct": "56.1%", "term_iv_wing_1_30_pct": "37.2%", "term_iv_wing_31_90_pct": "23.9%"}, {"date": "2025-12-12", "atm_iv_pct": "12.8%", "skew_down_bp": "+9.9 波动点", "skew_up_bp": "-0.4 波动点", "cpr_brief": "0.68（看跌占优）", "short_term_pressure_bp": "-0.2 波动点", "term_iv_slope_bp": "+0.9 波动点", "term_iv_fw_1_7_pct": "13.7%", "term_iv_1_30_pct": "13.9%", "term_iv_31_90_pct": "14.8%", "term_iv_wing_fw_1_7_pct": "36.9%", "term_iv_wing_1_30_pct": "32.1%", "term_iv_wing_31_90_pct": "24.5%"}]};

  (function () {
    const backdrop = document.getElementById('history-backdrop');
    const panel = document.getElementById('history-panel');
    const titleEl = document.getElementById('history-title');
    const subtitleEl = document.getElementById('history-subtitle');
    const tbody = document.getElementById('history-tbody');
    const closeBtn = document.getElementById('history-close');

    function openHistory(symbol, type) {
      const rows = (HISTORY && HISTORY[symbol]) || [];
      titleEl.textContent = symbol + ' 期权历史概览';
      titleEl.textContent = symbol + (type === "term" ? ' 期限结构历史' : ' 期权历史概览');

      const thead = document.querySelector('.history-table thead');
      if (!thead) return;

      if (type === "term") {
        subtitleEl.textContent = '最近 ' + rows.length + ' 个交易日：期限结构（ATM/WING）·短期压力·斜率';

        thead.innerHTML = `
          <tr>
            <th>日期</th>
            <th>ATM 1–7</th>
            <th>ATM 1–30</th>
            <th>ATM 31–90</th>
            <th>WING 1–7</th>
            <th>WING 1–30</th>
            <th>WING 31–90</th>
            <th>短期压力</th>
            <th>斜率</th>
          </tr>
        `;

        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.date ?? '-'}</td>
            <td>${r.term_iv_fw_1_7_pct ?? '-'}</td>
            <td>${r.term_iv_1_30_pct ?? '-'}</td>
            <td>${r.term_iv_31_90_pct ?? '-'}</td>
            <td>${r.term_iv_wing_fw_1_7_pct ?? '-'}</td>
            <td>${r.term_iv_wing_1_30_pct ?? '-'}</td>
            <td>${r.term_iv_wing_31_90_pct ?? '-'}</td>
            <td>${r.short_term_pressure_bp ?? '-'}</td>
            <td>${r.term_iv_slope_bp ?? '-'}</td>
          </tr>
        `).join('');
      } else {
        subtitleEl.textContent = '最近 ' + rows.length + ' 个交易日：30天ATM IV · Skew · Call/Put 持仓比';

        thead.innerHTML = `
          <tr>
            <th>日期</th>
            <th>30天ATM IV</th>
            <th>10%虚值看跌 Skew</th>
            <th>10%虚值看涨 Skew</th>
            <th>Call/Put 持仓比</th>
            <th>短期压力</th>
            <th>斜率</th>
          </tr>
        `;

        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r.date ?? '-'}</td>
            <td>${r.atm_iv_pct ?? '-'}</td>
            <td>${r.skew_down_bp ?? '-'}</td>
            <td>${r.skew_up_bp ?? '-'}</td>
            <td>${r.cpr_brief ?? '-'}</td>
            <td>${r.short_term_pressure_bp ?? '-'}</td>
            <td>${r.term_iv_slope_bp ?? '-'}</td>
          </tr>
        `).join('');
      }

      backdrop.style.display = 'block';
      panel.style.display = 'block';
    }

    function closeHistory() {
      backdrop.style.display = 'none';
      panel.style.display = 'none';
    }

    // ✅ 事件委托：任何 future 的 .history-trigger 都能点开
    document.addEventListener('click', (ev) => {
      const el = ev.target.closest('.history-trigger');
      if (!el) return;

      const symbol = el.dataset.symbol;
      if (!symbol) return;

      const type = el.dataset.historyType || "default";
      openHistory(symbol, type);
    });

    backdrop.addEventListener('click', closeHistory);
    closeBtn.addEventListener('click', closeHistory);
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape') closeHistory();
    });

  })();
</script>

</body>
</html>
