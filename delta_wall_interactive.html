<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>Delta 墙交互视图 - 2025-12-22</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <style>
  :root{
    --bg:#0b0f14;
    --fg:#e5e7eb;
    --muted:#9ca3af;
    --card:#111827;
    --border:#263244;
  }

  html, body{ background: var(--bg); color: var(--fg); }

  body {
    font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    margin: 16px auto;
    max-width: 1200px;
    line-height: 1.6;
  }

  .summary-text{ color: var(--muted); }
  #global-summary-text{ font-size: 26px; color: var(--fg); }

  .chart-container{
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
    background: var(--card);
  }

  .text-block{
    color: var(--fg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px;
    background: var(--card);
  }

  .notice{ color: var(--muted); }

  .top3-table th,
  .top3-table td{
    border: 1px solid var(--border);
    color: var(--fg);
  }

  .traffic{
    display:inline-flex;
    align-items:center;
    gap:10px;
    margin-left: 12px;
    vertical-align: middle;
  }
  .light{
    width: 16px;
    height: 16px;
    border-radius: 50%;
    opacity: .22;
    border: 1px solid rgba(255,255,255,.18);
  }
  .light.on{ opacity: 1; box-shadow: 0 0 10px rgba(255,255,255,.10); }
  .light.red{ background:#ff3b30; }
  .light.green{ background:#34c759; }

  .section-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 24px;
    align-items: flex-start;
    margin-top: 8px;
  }
  </style>
</head>

<body>
  <h1>SPX / Delta 墙 - 时间 & 空间交互视图</h1>

  <div class="controls">
    <label>
      标的：
      <select id="symbol-select">
        <option value="SPX" selected>SPX</option>
      </select>
    </label>
    <span id="trade-date-label">交易日：2025-12-22</span>
  </div>

  <h2>当日 Delta 墙综述 &amp; 交易方向</h2>
  <div class="summary-text" id="global-summary-text"></div>

  <div class="section-grid">
    <div class="section-col">
      <h2>一、时间视角：到期结构 Delta</h2>
      <div class="toggle-row">
        <span>范围：</span>
        <label><input type="radio" name="term-scope-mode" value="atm10" checked /> ATM ±10%</label>
        <label><input type="radio" name="term-scope-mode" value="wing10_20" /> WING 10–20%</label>
      </div>

      <div class="chart-container" id="term-delta-chart"></div>
      <div class="notice">提示：柱子高度表示该到期层的 Delta 强度（|净Δ|），点击某个到期桶可查看其历史。</div>

      <h3>该到期桶的 Delta 历史</h3>
      <div class="chart-container" id="term-history-chart"></div>
      <div class="text-block" id="term-history-text"></div>

      <h3>到期结构 Delta 变动 Top3（最近两个交易日）</h3>
      <div id="term-change-panel" class="summary-text"></div>
    </div>

    <div class="section-col">
      <h2>二、空间视角：价位结构 Delta</h2>
      <div class="toggle-row">
        <span>到期范围：</span>
        <label><input type="radio" name="space-scope-mode" value="dte_1_30" checked /> 第1月</label>
        <label><input type="radio" name="space-scope-mode" value="dte_30_90" /> 第2-3月</label>
      </div>

      <div class="chart-container" id="space-delta-chart"></div>
      <div class="notice">提示：柱子高度表示该价位桶的 Delta 强度（|净Δ|），点击某个价位桶可查看其历史。</div>

      <h3>该价位桶的 Delta 历史</h3>
      <div class="chart-container" id="space-history-chart"></div>
      <div class="text-block" id="space-history-text"></div>

      <h3>价位结构 Delta 变动 Top3（最近两个交易日）</h3>
      <div id="space-change-panel" class="summary-text"></div>
    </div>
  </div>

  <script>
    window.deltaWallCurrent = {"SPX": {"trade_date": "2025-12-22", "term_buckets_atm10": [{"expiry_bucket": "第1月", "call_net_sum": 110367474796.34741, "put_net_sum": -99557778311.03706, "metric_abs_sum": 209925253107.38446}, {"expiry_bucket": "第2月", "call_net_sum": 52190015795.905655, "put_net_sum": -27977104768.10491, "metric_abs_sum": 80167120564.01056}, {"expiry_bucket": "第3月", "call_net_sum": 175040872018.83667, "put_net_sum": -128398076347.74275, "metric_abs_sum": 303438948366.5794}, {"expiry_bucket": "第4月", "call_net_sum": 17971432524.98151, "put_net_sum": -11860055453.230051, "metric_abs_sum": 29831487978.211563}, {"expiry_bucket": "第5月", "call_net_sum": 20059134224.444126, "put_net_sum": -7304546280.01875, "metric_abs_sum": 27363680504.462875}, {"expiry_bucket": "第6月", "call_net_sum": 23419548982.953938, "put_net_sum": -7360605551.627209, "metric_abs_sum": 30780154534.581146}, {"expiry_bucket": "第7月", "call_net_sum": 28577702536.11645, "put_net_sum": -7716559697.929872, "metric_abs_sum": 36294262234.046326}, {"expiry_bucket": "第8月", "call_net_sum": 39824639646.47379, "put_net_sum": -19929330119.103477, "metric_abs_sum": 59753969765.57727}, {"expiry_bucket": "第9月", "call_net_sum": 16927525056.697777, "put_net_sum": -5944009459.657474, "metric_abs_sum": 22871534516.35525}, {"expiry_bucket": "第10月", "call_net_sum": 15051765320.003613, "put_net_sum": -3139687774.8183627, "metric_abs_sum": 18191453094.821976}, {"expiry_bucket": "第11月", "call_net_sum": 84139569351.51599, "put_net_sum": -43584477120.70447, "metric_abs_sum": 127724046472.22046}, {"expiry_bucket": "第12月", "call_net_sum": 3660826382.40437, "put_net_sum": -3283025596.2954187, "metric_abs_sum": 6943851978.699789}], "term_buckets_wing10_20": [{"expiry_bucket": "第1月", "call_net_sum": 153113698685.91034, "put_net_sum": -6285435547.921388, "metric_abs_sum": 159399134233.83173}, {"expiry_bucket": "第2月", "call_net_sum": 36548763741.54659, "put_net_sum": -5917377625.403616, "metric_abs_sum": 42466141366.95021}, {"expiry_bucket": "第3月", "call_net_sum": 149642987294.17633, "put_net_sum": -17715937197.15764, "metric_abs_sum": 167358924491.33398}, {"expiry_bucket": "第4月", "call_net_sum": 12951630908.80286, "put_net_sum": -2296450297.561341, "metric_abs_sum": 15248081206.3642}, {"expiry_bucket": "第5月", "call_net_sum": 15952745777.463533, "put_net_sum": -2815903233.075916, "metric_abs_sum": 18768649010.539448}, {"expiry_bucket": "第6月", "call_net_sum": 15663588888.880949, "put_net_sum": -3796153861.585884, "metric_abs_sum": 19459742750.466835}, {"expiry_bucket": "第7月", "call_net_sum": 13058176456.705383, "put_net_sum": -3256931606.0825357, "metric_abs_sum": 16315108062.787918}, {"expiry_bucket": "第8月", "call_net_sum": 20067355946.098064, "put_net_sum": -9177212087.154982, "metric_abs_sum": 29244568033.253044}, {"expiry_bucket": "第9月", "call_net_sum": 2422305700.772141, "put_net_sum": -1229638536.7920046, "metric_abs_sum": 3651944237.5641456}, {"expiry_bucket": "第10月", "call_net_sum": 850498567.0908234, "put_net_sum": -600150164.0052626, "metric_abs_sum": 1450648731.096086}, {"expiry_bucket": "第11月", "call_net_sum": 74963514996.92552, "put_net_sum": -19057718655.819798, "metric_abs_sum": 94021233652.74532}, {"expiry_bucket": "第12月", "call_net_sum": 2918630247.1445913, "put_net_sum": -970822245.3505448, "metric_abs_sum": 3889452492.4951363}], "space_buckets_dte_1_30": [{"strike_bucket": "5550", "call_net_sum": 884643250.3602923, "put_net_sum": -20304312.972493287, "call_abs_sum": 884643250.3602923, "put_abs_sum": 20304312.972493287, "total_abs_sum": 904947563.3327856}, {"strike_bucket": "5600", "call_net_sum": 3210003380.614967, "put_net_sum": -68889783.36609577, "call_abs_sum": 3210003380.614967, "put_abs_sum": 68889783.36609577, "total_abs_sum": 3278893163.9810624}, {"strike_bucket": "5650", "call_net_sum": 605544597.0272156, "put_net_sum": -33026085.102401223, "call_abs_sum": 605544597.0272156, "put_abs_sum": 33026085.102401223, "total_abs_sum": 638570682.1296169}, {"strike_bucket": "5700", "call_net_sum": 3561773649.611215, "put_net_sum": -89134710.4128361, "call_abs_sum": 3561773649.611215, "put_abs_sum": 89134710.4128361, "total_abs_sum": 3650908360.024051}, {"strike_bucket": "5750", "call_net_sum": 1293604170.7167387, "put_net_sum": -98877680.11968628, "call_abs_sum": 1293604170.7167387, "put_abs_sum": 98877680.11968628, "total_abs_sum": 1392481850.836425}, {"strike_bucket": "5800", "call_net_sum": 3688983670.1274858, "put_net_sum": -213479613.7019447, "call_abs_sum": 3688983670.1274858, "put_abs_sum": 213479613.7019447, "total_abs_sum": 3902463283.8294306}, {"strike_bucket": "5850", "call_net_sum": 1869181396.7235525, "put_net_sum": -68341032.23200874, "call_abs_sum": 1869181396.7235525, "put_abs_sum": 68341032.23200874, "total_abs_sum": 1937522428.9555612}, {"strike_bucket": "5900", "call_net_sum": 5346123622.847969, "put_net_sum": -196828465.34291458, "call_abs_sum": 5346123622.847969, "put_abs_sum": 196828465.34291458, "total_abs_sum": 5542952088.190884}, {"strike_bucket": "5950", "call_net_sum": 2173863550.58141, "put_net_sum": -108210411.30903916, "call_abs_sum": 2173863550.58141, "put_abs_sum": 108210411.30903916, "total_abs_sum": 2282073961.890449}, {"strike_bucket": "6000", "call_net_sum": 118143332314.69907, "put_net_sum": -2693224033.8057694, "call_abs_sum": 118143332314.69907, "put_abs_sum": 2693224033.8057694, "total_abs_sum": 120836556348.50484}, {"strike_bucket": "6050", "call_net_sum": 2503078325.4228735, "put_net_sum": -144547288.44968814, "call_abs_sum": 2503078325.4228735, "put_abs_sum": 144547288.44968814, "total_abs_sum": 2647625613.8725615}, {"strike_bucket": "6100", "call_net_sum": 4323588406.282469, "put_net_sum": -212662069.5465411, "call_abs_sum": 4323588406.282469, "put_abs_sum": 212662069.5465411, "total_abs_sum": 4536250475.82901}, {"strike_bucket": "6150", "call_net_sum": 2528986038.271778, "put_net_sum": -163450013.66986084, "call_abs_sum": 2528986038.271778, "put_abs_sum": 163450013.66986084, "total_abs_sum": 2692436051.941639}, {"strike_bucket": "6200", "call_net_sum": 4558849555.888639, "put_net_sum": -424200784.2520133, "call_abs_sum": 4558849555.888639, "put_abs_sum": 424200784.2520133, "total_abs_sum": 4983050340.140653}, {"strike_bucket": "6250", "call_net_sum": 2680933355.467305, "put_net_sum": -397236699.3690161, "call_abs_sum": 2680933355.467305, "put_abs_sum": 397236699.3690161, "total_abs_sum": 3078170054.8363214}, {"strike_bucket": "6300", "call_net_sum": 3440854775.158544, "put_net_sum": -449057223.20438516, "call_abs_sum": 3440854775.158544, "put_abs_sum": 449057223.20438516, "total_abs_sum": 3889911998.3629293}, {"strike_bucket": "6350", "call_net_sum": 1798822160.5521855, "put_net_sum": -307729019.85329425, "call_abs_sum": 1798822160.5521855, "put_abs_sum": 307729019.85329425, "total_abs_sum": 2106551180.40548}, {"strike_bucket": "6400", "call_net_sum": 5906816000.689824, "put_net_sum": -795362182.2661492, "call_abs_sum": 5906816000.689824, "put_abs_sum": 795362182.2661492, "total_abs_sum": 6702178182.955974}, {"strike_bucket": "6450", "call_net_sum": 2354198073.7985797, "put_net_sum": -443549120.73675954, "call_abs_sum": 2354198073.7985797, "put_abs_sum": 443549120.73675954, "total_abs_sum": 2797747194.5353394}, {"strike_bucket": "6500", "call_net_sum": 5344237860.284129, "put_net_sum": -1408253087.939718, "call_abs_sum": 5344237860.284129, "put_abs_sum": 1408253087.939718, "total_abs_sum": 6752490948.223847}, {"strike_bucket": "6550", "call_net_sum": 2096545422.4336827, "put_net_sum": -449958602.0686527, "call_abs_sum": 2096545422.4336827, "put_abs_sum": 449958602.0686527, "total_abs_sum": 2546504024.5023355}, {"strike_bucket": "6600", "call_net_sum": 4710046931.575224, "put_net_sum": -1243554428.4512324, "call_abs_sum": 4710046931.575224, "put_abs_sum": 1243554428.4512324, "total_abs_sum": 5953601360.026457}, {"strike_bucket": "6650", "call_net_sum": 2203928177.204638, "put_net_sum": -1519883565.7829142, "call_abs_sum": 2203928177.204638, "put_abs_sum": 1519883565.7829142, "total_abs_sum": 3723811742.987552}, {"strike_bucket": "6700", "call_net_sum": 6936951888.279325, "put_net_sum": -2091128617.4533856, "call_abs_sum": 6936951888.279325, "put_abs_sum": 2091128617.4533856, "total_abs_sum": 9028080505.73271}, {"strike_bucket": "6750", "call_net_sum": 4147242692.7153454, "put_net_sum": -2139524789.0008929, "call_abs_sum": 4147242692.7153454, "put_abs_sum": 2139524789.0008929, "total_abs_sum": 6286767481.716238}, {"strike_bucket": "6800", "call_net_sum": 8038786887.112688, "put_net_sum": -3642458072.6274614, "call_abs_sum": 8038786887.112688, "put_abs_sum": 3642458072.6274614, "total_abs_sum": 11681244959.74015}, {"strike_bucket": "6850", "call_net_sum": 10901372048.480663, "put_net_sum": -7618908594.702763, "call_abs_sum": 10901372048.480663, "put_abs_sum": 7618908594.702763, "total_abs_sum": 18520280643.183426}, {"strike_bucket": "6900", "call_net_sum": 9752036474.512178, "put_net_sum": -7492710617.7646265, "call_abs_sum": 9752036474.512178, "put_abs_sum": 7492710617.7646265, "total_abs_sum": 17244747092.276806}, {"strike_bucket": "6950", "call_net_sum": 1522273015.5640917, "put_net_sum": -478875407.916949, "call_abs_sum": 1522273015.5640917, "put_abs_sum": 478875407.916949, "total_abs_sum": 2001148423.4810407}, {"strike_bucket": "7000", "call_net_sum": 28211321006.64365, "put_net_sum": -67266845177.72536, "call_abs_sum": 28211321006.64365, "put_abs_sum": 67266845177.72536, "total_abs_sum": 95478166184.369}, {"strike_bucket": "7050", "call_net_sum": 1513308277.9623547, "put_net_sum": -30624428.444353674, "call_abs_sum": 1513308277.9623547, "put_abs_sum": 30624428.444353674, "total_abs_sum": 1543932706.4067082}, {"strike_bucket": "7100", "call_net_sum": 1574356370.6741953, "put_net_sum": -446913296.91513306, "call_abs_sum": 1574356370.6741953, "put_abs_sum": 446913296.91513306, "total_abs_sum": 2021269667.5893283}, {"strike_bucket": "7150", "call_net_sum": 461421728.7477947, "put_net_sum": -19029461.507000055, "call_abs_sum": 461421728.7477947, "put_abs_sum": 19029461.507000055, "total_abs_sum": 480451190.2547947}, {"strike_bucket": "7200", "call_net_sum": 500608729.07066137, "put_net_sum": -442163480.22492963, "call_abs_sum": 500608729.07066137, "put_abs_sum": 442163480.22492963, "total_abs_sum": 942772209.295591}, {"strike_bucket": "7250", "call_net_sum": 176557760.33893675, "put_net_sum": -13079548.769792885, "call_abs_sum": 176557760.33893675, "put_abs_sum": 13079548.769792885, "total_abs_sum": 189637309.10872963}, {"strike_bucket": "7300", "call_net_sum": 789862976.6122988, "put_net_sum": -112198040.64402376, "call_abs_sum": 789862976.6122988, "put_abs_sum": 112198040.64402376, "total_abs_sum": 902061017.2563226}, {"strike_bucket": "7350", "call_net_sum": 141436458.04131025, "put_net_sum": -24412296.638953324, "call_abs_sum": 141436458.04131025, "put_abs_sum": 24412296.638953324, "total_abs_sum": 165848754.68026358}, {"strike_bucket": "7400", "call_net_sum": 360050380.97550344, "put_net_sum": -38739319.40849605, "call_abs_sum": 360050380.97550344, "put_abs_sum": 38739319.40849605, "total_abs_sum": 398789700.38399947}, {"strike_bucket": "7450", "call_net_sum": 106535776.61757478, "put_net_sum": -3331871.8289214503, "call_abs_sum": 106535776.61757478, "put_abs_sum": 3331871.8289214503, "total_abs_sum": 109867648.44649623}, {"strike_bucket": "7500", "call_net_sum": 138120010.94608793, "put_net_sum": -258050575.53988487, "call_abs_sum": 138120010.94608793, "put_abs_sum": 258050575.53988487, "total_abs_sum": 396170586.48597276}, {"strike_bucket": "7600", "call_net_sum": 1890647805.2915223, "put_net_sum": -6491894.22629441, "call_abs_sum": 1890647805.2915223, "put_abs_sum": 6491894.22629441, "total_abs_sum": 1897139699.5178168}, {"strike_bucket": "7700", "call_net_sum": 305966400.87612826, "put_net_sum": -2018971.5457093345, "call_abs_sum": 305966400.87612826, "put_abs_sum": 2018971.5457093345, "total_abs_sum": 307985372.42183757}, {"strike_bucket": "7800", "call_net_sum": 436664238.49167514, "put_net_sum": -1239048.3086519754, "call_abs_sum": 436664238.49167514, "put_abs_sum": 1239048.3086519754, "total_abs_sum": 437903286.8003271}, {"strike_bucket": "7900", "call_net_sum": 248044356.83496106, "put_net_sum": -674953.5538853834, "call_abs_sum": 248044356.83496106, "put_abs_sum": 674953.5538853834, "total_abs_sum": 248719310.38884643}, {"strike_bucket": "8000", "call_net_sum": 88751630.5186875, "put_net_sum": -2065297762.5578241, "call_abs_sum": 88751630.5186875, "put_abs_sum": 2065297762.5578241, "total_abs_sum": 2154049393.076512}, {"strike_bucket": "8200", "call_net_sum": 10917880.610328931, "put_net_sum": -98737417.69774362, "call_abs_sum": 10917880.610328931, "put_abs_sum": 98737417.69774362, "total_abs_sum": 109655298.30807255}], "space_buckets_dte_30_90": [{"strike_bucket": "5550", "call_net_sum": 1924972780.0671284, "put_net_sum": -266283800.81280863, "call_abs_sum": 1924972780.0671284, "put_abs_sum": 266283800.81280863, "total_abs_sum": 2191256580.879937}, {"strike_bucket": "5600", "call_net_sum": 3983597864.527972, "put_net_sum": -445703193.4991405, "call_abs_sum": 3983597864.527972, "put_abs_sum": 445703193.4991405, "total_abs_sum": 4429301058.027113}, {"strike_bucket": "5650", "call_net_sum": 2898735131.277289, "put_net_sum": -322374127.6227397, "call_abs_sum": 2898735131.277289, "put_abs_sum": 322374127.6227397, "total_abs_sum": 3221109258.9000287}, {"strike_bucket": "5700", "call_net_sum": 3541531240.1594005, "put_net_sum": -636113765.2981598, "call_abs_sum": 3541531240.1594005, "put_abs_sum": 636113765.2981598, "total_abs_sum": 4177645005.4575605}, {"strike_bucket": "5750", "call_net_sum": 2747865212.2072754, "put_net_sum": -743064390.2784395, "call_abs_sum": 2747865212.2072754, "put_abs_sum": 743064390.2784395, "total_abs_sum": 3490929602.485715}, {"strike_bucket": "5800", "call_net_sum": 4705571475.521914, "put_net_sum": -909857345.2641227, "call_abs_sum": 4705571475.521914, "put_abs_sum": 909857345.2641227, "total_abs_sum": 5615428820.7860365}, {"strike_bucket": "5850", "call_net_sum": 3626654565.2397847, "put_net_sum": -518550677.7247567, "call_abs_sum": 3626654565.2397847, "put_abs_sum": 518550677.7247567, "total_abs_sum": 4145205242.9645414}, {"strike_bucket": "5900", "call_net_sum": 6688636326.350587, "put_net_sum": -1022824467.9696362, "call_abs_sum": 6688636326.350587, "put_abs_sum": 1022824467.9696362, "total_abs_sum": 7711460794.320223}, {"strike_bucket": "5950", "call_net_sum": 5169965196.263456, "put_net_sum": -530296300.3149226, "call_abs_sum": 5169965196.263456, "put_abs_sum": 530296300.3149226, "total_abs_sum": 5700261496.578379}, {"strike_bucket": "6000", "call_net_sum": 135235697162.59993, "put_net_sum": -13059905276.269785, "call_abs_sum": 135235697162.59993, "put_abs_sum": 13059905276.269785, "total_abs_sum": 148295602438.86972}, {"strike_bucket": "6050", "call_net_sum": 3279190626.1233764, "put_net_sum": -516122697.9704058, "call_abs_sum": 3279190626.1233764, "put_abs_sum": 516122697.9704058, "total_abs_sum": 3795313324.0937824}, {"strike_bucket": "6100", "call_net_sum": 6338895817.015184, "put_net_sum": -1565339331.0228, "call_abs_sum": 6338895817.015184, "put_abs_sum": 1565339331.0228, "total_abs_sum": 7904235148.037985}, {"strike_bucket": "6150", "call_net_sum": 3233229098.803414, "put_net_sum": -1231896381.8875113, "call_abs_sum": 3233229098.803414, "put_abs_sum": 1231896381.8875113, "total_abs_sum": 4465125480.690926}, {"strike_bucket": "6200", "call_net_sum": 5884868021.055479, "put_net_sum": -3103768192.071331, "call_abs_sum": 5884868021.055479, "put_abs_sum": 3103768192.071331, "total_abs_sum": 8988636213.12681}, {"strike_bucket": "6250", "call_net_sum": 4273970275.8797884, "put_net_sum": -1876056226.466773, "call_abs_sum": 4273970275.8797884, "put_abs_sum": 1876056226.466773, "total_abs_sum": 6150026502.346561}, {"strike_bucket": "6300", "call_net_sum": 9004625531.761063, "put_net_sum": -2953842792.5400753, "call_abs_sum": 9004625531.761063, "put_abs_sum": 2953842792.5400753, "total_abs_sum": 11958468324.301138}, {"strike_bucket": "6350", "call_net_sum": 4682141272.489996, "put_net_sum": -1327293226.8224125, "call_abs_sum": 4682141272.489996, "put_abs_sum": 1327293226.8224125, "total_abs_sum": 6009434499.312408}, {"strike_bucket": "6400", "call_net_sum": 6861718704.080675, "put_net_sum": -2975485310.209307, "call_abs_sum": 6861718704.080675, "put_abs_sum": 2975485310.209307, "total_abs_sum": 9837204014.289982}, {"strike_bucket": "6450", "call_net_sum": 3895599615.4321504, "put_net_sum": -2002252719.6518695, "call_abs_sum": 3895599615.4321504, "put_abs_sum": 2002252719.6518695, "total_abs_sum": 5897852335.08402}, {"strike_bucket": "6500", "call_net_sum": 9757007099.959883, "put_net_sum": -5710256066.484673, "call_abs_sum": 9757007099.959883, "put_abs_sum": 5710256066.484673, "total_abs_sum": 15467263166.444555}, {"strike_bucket": "6550", "call_net_sum": 2467939645.845809, "put_net_sum": -1238262833.1540766, "call_abs_sum": 2467939645.845809, "put_abs_sum": 1238262833.1540766, "total_abs_sum": 3706202478.9998856}, {"strike_bucket": "6600", "call_net_sum": 10690864825.823782, "put_net_sum": -4701649734.292111, "call_abs_sum": 10690864825.823782, "put_abs_sum": 4701649734.292111, "total_abs_sum": 15392514560.115894}, {"strike_bucket": "6650", "call_net_sum": 3174164641.6575756, "put_net_sum": -1736727697.0877476, "call_abs_sum": 3174164641.6575756, "put_abs_sum": 1736727697.0877476, "total_abs_sum": 4910892338.745323}, {"strike_bucket": "6700", "call_net_sum": 12604991353.67598, "put_net_sum": -8528346903.5486, "call_abs_sum": 12604991353.67598, "put_abs_sum": 8528346903.5486, "total_abs_sum": 21133338257.22458}, {"strike_bucket": "6750", "call_net_sum": 8051413435.769352, "put_net_sum": -3924225660.255101, "call_abs_sum": 8051413435.769352, "put_abs_sum": 3924225660.255101, "total_abs_sum": 11975639096.024452}, {"strike_bucket": "6800", "call_net_sum": 22136856389.844505, "put_net_sum": -11526890620.061707, "call_abs_sum": 22136856389.844505, "put_abs_sum": 11526890620.061707, "total_abs_sum": 33663747009.90621}, {"strike_bucket": "6850", "call_net_sum": 16966537926.162056, "put_net_sum": -10857522215.70282, "call_abs_sum": 16966537926.162056, "put_abs_sum": 10857522215.70282, "total_abs_sum": 27824060141.864876}, {"strike_bucket": "6900", "call_net_sum": 24478090542.15384, "put_net_sum": -19183563124.79592, "call_abs_sum": 24478090542.15384, "put_abs_sum": 19183563124.79592, "total_abs_sum": 43661653666.94976}, {"strike_bucket": "6950", "call_net_sum": 2534019770.273451, "put_net_sum": -1050600672.2553182, "call_abs_sum": 2534019770.273451, "put_abs_sum": 1050600672.2553182, "total_abs_sum": 3584620442.528769}, {"strike_bucket": "7000", "call_net_sum": 61755348462.6172, "put_net_sum": -67989155571.30852, "call_abs_sum": 61755348462.6172, "put_abs_sum": 67989155571.30852, "total_abs_sum": 129744504033.92572}, {"strike_bucket": "7050", "call_net_sum": 1886583556.2635305, "put_net_sum": -623447631.152904, "call_abs_sum": 1886583556.2635305, "put_abs_sum": 623447631.152904, "total_abs_sum": 2510031187.4164343}, {"strike_bucket": "7100", "call_net_sum": 4489890562.981762, "put_net_sum": -175942204.0011804, "call_abs_sum": 4489890562.981762, "put_abs_sum": 175942204.0011804, "total_abs_sum": 4665832766.982943}, {"strike_bucket": "7150", "call_net_sum": 1837508853.7298656, "put_net_sum": -111534747.17499301, "call_abs_sum": 1837508853.7298656, "put_abs_sum": 111534747.17499301, "total_abs_sum": 1949043600.9048586}, {"strike_bucket": "7200", "call_net_sum": 3896513969.7232375, "put_net_sum": -1838491503.6692722, "call_abs_sum": 3896513969.7232375, "put_abs_sum": 1838491503.6692722, "total_abs_sum": 5735005473.392509}, {"strike_bucket": "7250", "call_net_sum": 1263730186.2049217, "put_net_sum": -489346941.714819, "call_abs_sum": 1263730186.2049217, "put_abs_sum": 489346941.714819, "total_abs_sum": 1753077127.9197407}, {"strike_bucket": "7300", "call_net_sum": 2098117680.3215835, "put_net_sum": -1724645551.8785717, "call_abs_sum": 2098117680.3215835, "put_abs_sum": 1724645551.8785717, "total_abs_sum": 3822763232.2001553}, {"strike_bucket": "7350", "call_net_sum": 635318259.3394661, "put_net_sum": -4574187.706530476, "call_abs_sum": 635318259.3394661, "put_abs_sum": 4574187.706530476, "total_abs_sum": 639892447.0459965}, {"strike_bucket": "7400", "call_net_sum": 988669092.4492911, "put_net_sum": -146505402.13053492, "call_abs_sum": 988669092.4492911, "put_abs_sum": 146505402.13053492, "total_abs_sum": 1135174494.579826}, {"strike_bucket": "7450", "call_net_sum": 283395560.8554793, "put_net_sum": -3170494.6854493376, "call_abs_sum": 283395560.8554793, "put_abs_sum": 3170494.6854493376, "total_abs_sum": 286566055.54092866}, {"strike_bucket": "7500", "call_net_sum": 466627565.3424778, "put_net_sum": -566491673.3514528, "call_abs_sum": 466627565.3424778, "put_abs_sum": 566491673.3514528, "total_abs_sum": 1033119238.6939306}, {"strike_bucket": "7550", "call_net_sum": 164375013.0481293, "put_net_sum": -5131211.673599021, "call_abs_sum": 164375013.0481293, "put_abs_sum": 5131211.673599021, "total_abs_sum": 169506224.72172832}, {"strike_bucket": "7600", "call_net_sum": 446269145.60586935, "put_net_sum": -5518874.627121885, "call_abs_sum": 446269145.60586935, "put_abs_sum": 5518874.627121885, "total_abs_sum": 451788020.2329912}, {"strike_bucket": "7650", "call_net_sum": 46467216.66130069, "put_net_sum": 0.0, "call_abs_sum": 46467216.66130069, "put_abs_sum": 0.0, "total_abs_sum": 46467216.66130069}, {"strike_bucket": "7700", "call_net_sum": 739126994.2006732, "put_net_sum": -13268587.207393982, "call_abs_sum": 739126994.2006732, "put_abs_sum": 13268587.207393982, "total_abs_sum": 752395581.4080672}, {"strike_bucket": "7750", "call_net_sum": 67918305.08434655, "put_net_sum": 0.0, "call_abs_sum": 67918305.08434655, "put_abs_sum": 0.0, "total_abs_sum": 67918305.08434655}, {"strike_bucket": "7800", "call_net_sum": 332844075.54087687, "put_net_sum": -3907185.036880863, "call_abs_sum": 332844075.54087687, "put_abs_sum": 3907185.036880863, "total_abs_sum": 336751260.5777577}, {"strike_bucket": "7850", "call_net_sum": 241990.17323706052, "put_net_sum": 0.0, "call_abs_sum": 241990.17323706052, "put_abs_sum": 0.0, "total_abs_sum": 241990.17323706052}, {"strike_bucket": "7900", "call_net_sum": 52753659.4436081, "put_net_sum": -1282095.9278290514, "call_abs_sum": 52753659.4436081, "put_abs_sum": 1282095.9278290514, "total_abs_sum": 54035755.37143715}, {"strike_bucket": "8000", "call_net_sum": 716648432.5537825, "put_net_sum": -1839705141.1288161, "call_abs_sum": 716648432.5537825, "put_abs_sum": 1839705141.1288161, "total_abs_sum": 2556353573.6825986}, {"strike_bucket": "8200", "call_net_sum": 414938720.30252045, "put_net_sum": -1301182.6979834635, "call_abs_sum": 414938720.30252045, "put_abs_sum": 1301182.6979834635, "total_abs_sum": 416239903.0005039}]}};
    window.deltaWallHistory = {"term_atm10": {"SPX": {"第1月": {"dates": ["2025-12-22"], "call_net_values": [110367474796.34741], "put_net_values": [-99557778311.03706], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第2月": {"dates": ["2025-12-22"], "call_net_values": [52190015795.905655], "put_net_values": [-27977104768.10491], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第3月": {"dates": ["2025-12-22"], "call_net_values": [175040872018.83667], "put_net_values": [-128398076347.74275], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第4月": {"dates": ["2025-12-22"], "call_net_values": [17971432524.98151], "put_net_values": [-11860055453.230051], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第5月": {"dates": ["2025-12-22"], "call_net_values": [20059134224.444126], "put_net_values": [-7304546280.01875], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第6月": {"dates": ["2025-12-22"], "call_net_values": [23419548982.953938], "put_net_values": [-7360605551.627209], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第7月": {"dates": ["2025-12-22"], "call_net_values": [28577702536.11645], "put_net_values": [-7716559697.929872], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第8月": {"dates": ["2025-12-22"], "call_net_values": [39824639646.47379], "put_net_values": [-19929330119.103477], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第9月": {"dates": ["2025-12-22"], "call_net_values": [16927525056.697777], "put_net_values": [-5944009459.657474], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第10月": {"dates": ["2025-12-22"], "call_net_values": [15051765320.003613], "put_net_values": [-3139687774.8183627], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第11月": {"dates": ["2025-12-22"], "call_net_values": [84139569351.51599], "put_net_values": [-43584477120.70447], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第12月": {"dates": ["2025-12-22"], "call_net_values": [3660826382.40437], "put_net_values": [-3283025596.2954187], "price_values": [6878.490234375], "interpret_text_cn": ""}}}, "term_wing10_20": {"SPX": {"第1月": {"dates": ["2025-12-22"], "call_net_values": [153113698685.91034], "put_net_values": [-6285435547.921388], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第2月": {"dates": ["2025-12-22"], "call_net_values": [36548763741.54659], "put_net_values": [-5917377625.403616], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第3月": {"dates": ["2025-12-22"], "call_net_values": [149642987294.17633], "put_net_values": [-17715937197.15764], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第4月": {"dates": ["2025-12-22"], "call_net_values": [12951630908.80286], "put_net_values": [-2296450297.561341], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第5月": {"dates": ["2025-12-22"], "call_net_values": [15952745777.463533], "put_net_values": [-2815903233.075916], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第6月": {"dates": ["2025-12-22"], "call_net_values": [15663588888.880949], "put_net_values": [-3796153861.585884], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第7月": {"dates": ["2025-12-22"], "call_net_values": [13058176456.705383], "put_net_values": [-3256931606.0825357], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第8月": {"dates": ["2025-12-22"], "call_net_values": [20067355946.098064], "put_net_values": [-9177212087.154982], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第9月": {"dates": ["2025-12-22"], "call_net_values": [2422305700.772141], "put_net_values": [-1229638536.7920046], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第10月": {"dates": ["2025-12-22"], "call_net_values": [850498567.0908234], "put_net_values": [-600150164.0052626], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第11月": {"dates": ["2025-12-22"], "call_net_values": [74963514996.92552], "put_net_values": [-19057718655.819798], "price_values": [6878.490234375], "interpret_text_cn": ""}, "第12月": {"dates": ["2025-12-22"], "call_net_values": [2918630247.1445913], "put_net_values": [-970822245.3505448], "price_values": [6878.490234375], "interpret_text_cn": ""}}}, "space_dte_1_30": {"SPX": {"5550": {"dates": ["2025-12-22"], "call_abs_values": [884643250.3602923], "put_abs_values": [20304312.972493287], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5600": {"dates": ["2025-12-22"], "call_abs_values": [3210003380.614967], "put_abs_values": [68889783.36609577], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5650": {"dates": ["2025-12-22"], "call_abs_values": [605544597.0272156], "put_abs_values": [33026085.102401223], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5700": {"dates": ["2025-12-22"], "call_abs_values": [3561773649.611215], "put_abs_values": [89134710.4128361], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5750": {"dates": ["2025-12-22"], "call_abs_values": [1293604170.7167387], "put_abs_values": [98877680.11968628], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5800": {"dates": ["2025-12-22"], "call_abs_values": [3688983670.1274858], "put_abs_values": [213479613.7019447], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5850": {"dates": ["2025-12-22"], "call_abs_values": [1869181396.7235525], "put_abs_values": [68341032.23200874], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5900": {"dates": ["2025-12-22"], "call_abs_values": [5346123622.847969], "put_abs_values": [196828465.34291458], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5950": {"dates": ["2025-12-22"], "call_abs_values": [2173863550.58141], "put_abs_values": [108210411.30903916], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6000": {"dates": ["2025-12-22"], "call_abs_values": [118143332314.69907], "put_abs_values": [2693224033.8057694], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6050": {"dates": ["2025-12-22"], "call_abs_values": [2503078325.4228735], "put_abs_values": [144547288.44968814], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6100": {"dates": ["2025-12-22"], "call_abs_values": [4323588406.282469], "put_abs_values": [212662069.5465411], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6150": {"dates": ["2025-12-22"], "call_abs_values": [2528986038.271778], "put_abs_values": [163450013.66986084], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6200": {"dates": ["2025-12-22"], "call_abs_values": [4558849555.888639], "put_abs_values": [424200784.2520133], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6250": {"dates": ["2025-12-22"], "call_abs_values": [2680933355.467305], "put_abs_values": [397236699.3690161], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6300": {"dates": ["2025-12-22"], "call_abs_values": [3440854775.158544], "put_abs_values": [449057223.20438516], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6350": {"dates": ["2025-12-22"], "call_abs_values": [1798822160.5521855], "put_abs_values": [307729019.85329425], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6400": {"dates": ["2025-12-22"], "call_abs_values": [5906816000.689824], "put_abs_values": [795362182.2661492], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6450": {"dates": ["2025-12-22"], "call_abs_values": [2354198073.7985797], "put_abs_values": [443549120.73675954], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6500": {"dates": ["2025-12-22"], "call_abs_values": [5344237860.284129], "put_abs_values": [1408253087.939718], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6550": {"dates": ["2025-12-22"], "call_abs_values": [2096545422.4336827], "put_abs_values": [449958602.0686527], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6600": {"dates": ["2025-12-22"], "call_abs_values": [4710046931.575224], "put_abs_values": [1243554428.4512324], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6650": {"dates": ["2025-12-22"], "call_abs_values": [2203928177.204638], "put_abs_values": [1519883565.7829142], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6700": {"dates": ["2025-12-22"], "call_abs_values": [6936951888.279325], "put_abs_values": [2091128617.4533856], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6750": {"dates": ["2025-12-22"], "call_abs_values": [4147242692.7153454], "put_abs_values": [2139524789.0008929], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6800": {"dates": ["2025-12-22"], "call_abs_values": [8038786887.112688], "put_abs_values": [3642458072.6274614], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6850": {"dates": ["2025-12-22"], "call_abs_values": [10901372048.480663], "put_abs_values": [7618908594.702763], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6900": {"dates": ["2025-12-22"], "call_abs_values": [9752036474.512178], "put_abs_values": [7492710617.7646265], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6950": {"dates": ["2025-12-22"], "call_abs_values": [1522273015.5640917], "put_abs_values": [478875407.916949], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7000": {"dates": ["2025-12-22"], "call_abs_values": [28211321006.64365], "put_abs_values": [67266845177.72536], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7050": {"dates": ["2025-12-22"], "call_abs_values": [1513308277.9623547], "put_abs_values": [30624428.444353674], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7100": {"dates": ["2025-12-22"], "call_abs_values": [1574356370.6741953], "put_abs_values": [446913296.91513306], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7150": {"dates": ["2025-12-22"], "call_abs_values": [461421728.7477947], "put_abs_values": [19029461.507000055], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7200": {"dates": ["2025-12-22"], "call_abs_values": [500608729.07066137], "put_abs_values": [442163480.22492963], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7250": {"dates": ["2025-12-22"], "call_abs_values": [176557760.33893675], "put_abs_values": [13079548.769792885], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7300": {"dates": ["2025-12-22"], "call_abs_values": [789862976.6122988], "put_abs_values": [112198040.64402376], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7350": {"dates": ["2025-12-22"], "call_abs_values": [141436458.04131025], "put_abs_values": [24412296.638953324], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7400": {"dates": ["2025-12-22"], "call_abs_values": [360050380.97550344], "put_abs_values": [38739319.40849605], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7450": {"dates": ["2025-12-22"], "call_abs_values": [106535776.61757478], "put_abs_values": [3331871.8289214503], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7500": {"dates": ["2025-12-22"], "call_abs_values": [138120010.94608793], "put_abs_values": [258050575.53988487], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7600": {"dates": ["2025-12-22"], "call_abs_values": [1890647805.2915223], "put_abs_values": [6491894.22629441], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7700": {"dates": ["2025-12-22"], "call_abs_values": [305966400.87612826], "put_abs_values": [2018971.5457093345], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7800": {"dates": ["2025-12-22"], "call_abs_values": [436664238.49167514], "put_abs_values": [1239048.3086519754], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7900": {"dates": ["2025-12-22"], "call_abs_values": [248044356.83496106], "put_abs_values": [674953.5538853834], "price_values": [6878.490234375], "interpret_text_cn": ""}, "8000": {"dates": ["2025-12-22"], "call_abs_values": [88751630.5186875], "put_abs_values": [2065297762.5578241], "price_values": [6878.490234375], "interpret_text_cn": ""}, "8200": {"dates": ["2025-12-22"], "call_abs_values": [10917880.610328931], "put_abs_values": [98737417.69774362], "price_values": [6878.490234375], "interpret_text_cn": ""}}}, "space_dte_30_90": {"SPX": {"5550": {"dates": ["2025-12-22"], "call_abs_values": [1924972780.0671284], "put_abs_values": [266283800.81280863], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5600": {"dates": ["2025-12-22"], "call_abs_values": [3983597864.527972], "put_abs_values": [445703193.4991405], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5650": {"dates": ["2025-12-22"], "call_abs_values": [2898735131.277289], "put_abs_values": [322374127.6227397], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5700": {"dates": ["2025-12-22"], "call_abs_values": [3541531240.1594005], "put_abs_values": [636113765.2981598], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5750": {"dates": ["2025-12-22"], "call_abs_values": [2747865212.2072754], "put_abs_values": [743064390.2784395], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5800": {"dates": ["2025-12-22"], "call_abs_values": [4705571475.521914], "put_abs_values": [909857345.2641227], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5850": {"dates": ["2025-12-22"], "call_abs_values": [3626654565.2397847], "put_abs_values": [518550677.7247567], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5900": {"dates": ["2025-12-22"], "call_abs_values": [6688636326.350587], "put_abs_values": [1022824467.9696362], "price_values": [6878.490234375], "interpret_text_cn": ""}, "5950": {"dates": ["2025-12-22"], "call_abs_values": [5169965196.263456], "put_abs_values": [530296300.3149226], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6000": {"dates": ["2025-12-22"], "call_abs_values": [135235697162.59993], "put_abs_values": [13059905276.269785], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6050": {"dates": ["2025-12-22"], "call_abs_values": [3279190626.1233764], "put_abs_values": [516122697.9704058], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6100": {"dates": ["2025-12-22"], "call_abs_values": [6338895817.015184], "put_abs_values": [1565339331.0228], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6150": {"dates": ["2025-12-22"], "call_abs_values": [3233229098.803414], "put_abs_values": [1231896381.8875113], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6200": {"dates": ["2025-12-22"], "call_abs_values": [5884868021.055479], "put_abs_values": [3103768192.071331], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6250": {"dates": ["2025-12-22"], "call_abs_values": [4273970275.8797884], "put_abs_values": [1876056226.466773], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6300": {"dates": ["2025-12-22"], "call_abs_values": [9004625531.761063], "put_abs_values": [2953842792.5400753], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6350": {"dates": ["2025-12-22"], "call_abs_values": [4682141272.489996], "put_abs_values": [1327293226.8224125], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6400": {"dates": ["2025-12-22"], "call_abs_values": [6861718704.080675], "put_abs_values": [2975485310.209307], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6450": {"dates": ["2025-12-22"], "call_abs_values": [3895599615.4321504], "put_abs_values": [2002252719.6518695], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6500": {"dates": ["2025-12-22"], "call_abs_values": [9757007099.959883], "put_abs_values": [5710256066.484673], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6550": {"dates": ["2025-12-22"], "call_abs_values": [2467939645.845809], "put_abs_values": [1238262833.1540766], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6600": {"dates": ["2025-12-22"], "call_abs_values": [10690864825.823782], "put_abs_values": [4701649734.292111], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6650": {"dates": ["2025-12-22"], "call_abs_values": [3174164641.6575756], "put_abs_values": [1736727697.0877476], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6700": {"dates": ["2025-12-22"], "call_abs_values": [12604991353.67598], "put_abs_values": [8528346903.5486], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6750": {"dates": ["2025-12-22"], "call_abs_values": [8051413435.769352], "put_abs_values": [3924225660.255101], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6800": {"dates": ["2025-12-22"], "call_abs_values": [22136856389.844505], "put_abs_values": [11526890620.061707], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6850": {"dates": ["2025-12-22"], "call_abs_values": [16966537926.162056], "put_abs_values": [10857522215.70282], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6900": {"dates": ["2025-12-22"], "call_abs_values": [24478090542.15384], "put_abs_values": [19183563124.79592], "price_values": [6878.490234375], "interpret_text_cn": ""}, "6950": {"dates": ["2025-12-22"], "call_abs_values": [2534019770.273451], "put_abs_values": [1050600672.2553182], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7000": {"dates": ["2025-12-22"], "call_abs_values": [61755348462.6172], "put_abs_values": [67989155571.30852], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7050": {"dates": ["2025-12-22"], "call_abs_values": [1886583556.2635305], "put_abs_values": [623447631.152904], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7100": {"dates": ["2025-12-22"], "call_abs_values": [4489890562.981762], "put_abs_values": [175942204.0011804], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7150": {"dates": ["2025-12-22"], "call_abs_values": [1837508853.7298656], "put_abs_values": [111534747.17499301], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7200": {"dates": ["2025-12-22"], "call_abs_values": [3896513969.7232375], "put_abs_values": [1838491503.6692722], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7250": {"dates": ["2025-12-22"], "call_abs_values": [1263730186.2049217], "put_abs_values": [489346941.714819], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7300": {"dates": ["2025-12-22"], "call_abs_values": [2098117680.3215835], "put_abs_values": [1724645551.8785717], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7350": {"dates": ["2025-12-22"], "call_abs_values": [635318259.3394661], "put_abs_values": [4574187.706530476], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7400": {"dates": ["2025-12-22"], "call_abs_values": [988669092.4492911], "put_abs_values": [146505402.13053492], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7450": {"dates": ["2025-12-22"], "call_abs_values": [283395560.8554793], "put_abs_values": [3170494.6854493376], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7500": {"dates": ["2025-12-22"], "call_abs_values": [466627565.3424778], "put_abs_values": [566491673.3514528], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7550": {"dates": ["2025-12-22"], "call_abs_values": [164375013.0481293], "put_abs_values": [5131211.673599021], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7600": {"dates": ["2025-12-22"], "call_abs_values": [446269145.60586935], "put_abs_values": [5518874.627121885], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7650": {"dates": ["2025-12-22"], "call_abs_values": [46467216.66130069], "put_abs_values": [0.0], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7700": {"dates": ["2025-12-22"], "call_abs_values": [739126994.2006732], "put_abs_values": [13268587.207393982], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7750": {"dates": ["2025-12-22"], "call_abs_values": [67918305.08434655], "put_abs_values": [0.0], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7800": {"dates": ["2025-12-22"], "call_abs_values": [332844075.54087687], "put_abs_values": [3907185.036880863], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7850": {"dates": ["2025-12-22"], "call_abs_values": [241990.17323706052], "put_abs_values": [0.0], "price_values": [6878.490234375], "interpret_text_cn": ""}, "7900": {"dates": ["2025-12-22"], "call_abs_values": [52753659.4436081], "put_abs_values": [1282095.9278290514], "price_values": [6878.490234375], "interpret_text_cn": ""}, "8000": {"dates": ["2025-12-22"], "call_abs_values": [716648432.5537825], "put_abs_values": [1839705141.1288161], "price_values": [6878.490234375], "interpret_text_cn": ""}, "8200": {"dates": ["2025-12-22"], "call_abs_values": [414938720.30252045], "put_abs_values": [1301182.6979834635], "price_values": [6878.490234375], "interpret_text_cn": ""}}}, "term_changes_atm10": {"SPX": null}, "term_changes_wing10_20": {"SPX": null}, "space_changes_dte_1_30": {"SPX": null}, "space_changes_dte_30_90": {"SPX": null}, "trade_summary": {"SPX": {"market_state_cn": "偏多/偏稳", "market_state_reason_cn": "Call Δ 强度明显高于 Put：上行参与更积极", "final_text_cn": "SPX：Call Δ 强度明显高于 Put：上行参与更积极（仅用于结构观察）。", "trade_hint_cn": "更偏进攻：以你的宽度/技术信号为主执行。"}}, "close_prices": {"SPX": {"dates": ["2025-12-22"], "values": [6878.490234375]}}};
    window.deltaWallDefaultSymbol = "SPX";
  </script>

  <script>
  const DARK_BG   = "#0b0f14";
  const DARK_FG   = "#e5e7eb";
  const DARK_GRID = "#263244";

  function applyPlotlyDark(layout){
    layout = layout || {};
    layout.template = "plotly_dark";
    layout.paper_bgcolor = DARK_BG;
    layout.plot_bgcolor  = DARK_BG;
    layout.font = Object.assign({color: DARK_FG}, layout.font || {});

    const patchAxis = (ax) => Object.assign({
      gridcolor: DARK_GRID,
      zerolinecolor: DARK_GRID,
      linecolor: DARK_GRID,
      tickfont: {color: DARK_FG},
      titlefont: {color: DARK_FG},
    }, ax || {});

    layout.xaxis = patchAxis(layout.xaxis);
    layout.yaxis = patchAxis(layout.yaxis);

    if (layout.yaxis2){
      layout.yaxis2 = Object.assign({
        tickfont: {color: DARK_FG},
        titlefont: {color: DARK_FG},
        linecolor: DARK_GRID,
      }, layout.yaxis2);
    }

    layout.legend = Object.assign({
      bgcolor: "rgba(0,0,0,0)",
      font: {color: DARK_FG},
    }, layout.legend || {});

    return layout;
  }

  (function() {
    const CALL_COLOR  = "#34c759";
    const PUT_COLOR   = "#ff3b30";
    const PRICE_COLOR = "#ff69b4";

    const currentData = window.deltaWallCurrent || {};
    const historyData = window.deltaWallHistory || {};

    const termHistoryAtm10     = historyData.term_atm10 || {};
    const termHistoryWing10_20 = historyData.term_wing10_20 || {};

    const termChangesAtm10     = historyData.term_changes_atm10 || {};
    const termChangesWing10_20 = historyData.term_changes_wing10_20 || {};

    const spaceHistory1_30  = historyData.space_dte_1_30 || {};
    const spaceHistory30_90 = historyData.space_dte_30_90 || {};

    const spaceChanges1_30  = historyData.space_changes_dte_1_30 || {};
    const spaceChanges30_90 = historyData.space_changes_dte_30_90 || {};

    const summaryData = historyData.trade_summary || {};
    const closeSeries = historyData.close_prices  || {};

    const symbols = Object.keys(currentData);
    let currentSymbol = window.deltaWallDefaultSymbol && symbols.includes(window.deltaWallDefaultSymbol)
      ? window.deltaWallDefaultSymbol
      : (symbols[0] || null);

    let spaceScopeMode = "dte_1_30";
    let termScopeMode  = "atm10";

    let currentTermBucket  = null;
    let currentSpaceBucket = null;

    function alignCloseToDates(dates){
      const cs = closeSeries[currentSymbol];
      if (!cs || !Array.isArray(cs.dates) || !Array.isArray(cs.values)) return null;

      const m = {};
      for (let i = 0; i < cs.dates.length; i++) {
        m[String(cs.dates[i])] = cs.values[i];
      }
      return (dates || []).map(d => {
        const k = String(d);
        const v = Object.prototype.hasOwnProperty.call(m, k) ? m[k] : null;
        return (v == null ? null : Number(v));
      });
    }

    function detectBucketKey(rows) {
      if (!rows || !rows.length) return null;
      const keys = Object.keys(rows[0] || {});
      const prefer = ["strike_bucket", "strike_bucket_abs", "bucket", "price_bucket"];
      for (const p of prefer) if (keys.includes(p)) return p;
      for (const k of keys) if (k.toLowerCase().includes("bucket")) return k;
      return null;
    }

    function getSpaceBucket(row, bucketKey) {
      if (!row) return "";
      if (bucketKey && row[bucketKey] != null) return row[bucketKey];
      return row.strike_bucket || row.strike_bucket_abs || row.bucket || "";
    }

    function getSpaceRankValue(row) {
      if (!row) return 0;
      if (typeof row.total_abs_sum === "number") return Math.abs(row.total_abs_sum);

      const ca = (typeof row.call_abs_sum === "number") ? row.call_abs_sum : Math.abs(row.call_net_sum || 0);
      const pa = (typeof row.put_net_sum === "number") ? Math.abs(row.put_net_sum || 0) : Math.abs(row.put_net_sum_signed || 0);
      return ca + pa;
    }

    function getSpaceBucketsForScope(symData) {
      if (!symData) return [];
      return (spaceScopeMode === "dte_30_90")
        ? (symData.space_buckets_dte_30_90 || [])
        : (symData.space_buckets_dte_1_30 || []);
    }

    function getSpaceHistoryForScope() {
      return (spaceScopeMode === "dte_30_90") ? spaceHistory30_90 : spaceHistory1_30;
    }

    function getSpaceChangesForScope() {
      return (spaceScopeMode === "dte_30_90") ? spaceChanges30_90 : spaceChanges1_30;
    }

    function renderGlobalSummary() {
      const box = document.getElementById("global-summary-text");
      if (!box) return;

      const symData = summaryData[currentSymbol];
      if (!symData) {
        box.textContent = "当前标的尚未生成当日 Delta 墙综合解读。";
        return;
      }

      const stateCN = symData.market_state_cn || "";
      const mainText =
        symData.final_text_cn ||
        symData.summary_text_cn ||
        symData.interpret_text_cn ||
        "";
      const hintText = symData.trade_hint_cn || "";

      function inferLight(stateText) {
        const s = String(stateText || "");
        if (/(风险|防守|偏空)/.test(s)) return "red";
        return "green";
      }
      const light = inferLight(stateCN);

      const trafficHTML = `
        <span class="traffic" title="市场状态红绿灯（红=风险/防守，绿=偏多/进攻）">
          <span class="light red ${light==="red" ? "on" : ""}"></span>
          <span class="light green ${light==="green" ? "on" : ""}"></span>
        </span>
      `;

      const parts = [];
      if (stateCN) parts.push(`<p><strong>市场状态：</strong>${stateCN}${trafficHTML}</p>`);
      if (mainText) parts.push(`<p>${mainText}</p>`);
      if (hintText) parts.push(`<p><strong>操作建议：</strong>${hintText}</p>`);

      box.innerHTML = parts.join("") || "当前标的尚未生成当日 Delta 墙综合解读。";
    }

    function renderSymbolOptions() {
      const sel = document.getElementById("symbol-select");
      if (!sel) return;

      sel.innerHTML = "";
      symbols.forEach(sym => {
        const opt = document.createElement("option");
        opt.value = sym;
        opt.textContent = sym;
        if (sym === currentSymbol) opt.selected = true;
        sel.appendChild(opt);
      });

      sel.onchange = function() {
        currentSymbol = this.value;
        renderGlobalSummary();
        renderTermChart();
        autoSelectTermBucket();
        renderSpaceChart();
        autoSelectSpaceBucket();
        renderTermChangePanel();
        renderSpaceChangePanel();
      };
    }

    function renderTermChart() {
      const container = document.getElementById("term-delta-chart");
      const dateLabel = document.getElementById("trade-date-label");
      const symData = currentData[currentSymbol];

      if (!symData) {
        container.innerHTML = "<p>该标的暂无当日到期结构 Delta 数据。</p>";
        if (dateLabel) dateLabel.textContent = "交易日：--";
        return;
      }

      const atm10Buckets     = symData.term_buckets_atm10 || [];
      const wing10_20Buckets = symData.term_buckets_wing10_20 || [];
      const srcBuckets = (termScopeMode === "wing10_20") ? wing10_20Buckets : atm10Buckets;

      if (!srcBuckets.length) {
        container.innerHTML = "<p>该标的暂无当日到期结构 Delta 数据。</p>";
        if (dateLabel) dateLabel.textContent = "交易日：--";
        return;
      }

      if (dateLabel) dateLabel.textContent = "交易日：" + (symData.trade_date || "");

      const buckets = [];
      const callAbs = [];
      const putAbs  = [];

      srcBuckets.forEach(row => {
        const bucket = row.expiry_bucket;
        buckets.push(bucket);
        callAbs.push(Math.abs(row.call_net_sum || 0));
        putAbs.push(Math.abs(row.put_net_sum || 0));
      });

      const data = [
        {
          type: "bar",
          name: "Call Δ",
          x: buckets,
          y: callAbs,
          customdata: buckets,
          hovertemplate: "到期桶: %{x}<br>Call 强度(|净Δ|): %{y:.2e}<extra></extra>",
          marker: { color: CALL_COLOR },
        },
        {
          type: "bar",
          name: "Put Δ",
          x: buckets,
          y: putAbs,
          customdata: buckets,
          hovertemplate: "到期桶: %{x}<br>Put 强度(|净Δ|): %{y:.2e}<extra></extra>",
          marker: { color: PUT_COLOR },
        },
      ];

      const layout = applyPlotlyDark({
        margin: { l: 60, r: 10, t: 20, b: 40 },
        yaxis: { title: { text: "Delta 强度（|净Δ|）" } },
        xaxis: { title: { text: "到期桶（按第n月）" } },
        height: 360,
        barmode: "group",
      });

      Plotly.newPlot(container, data, layout, { displayModeBar: false });

      if (container.removeAllListeners) container.removeAllListeners("plotly_click");
      container.on("plotly_click", function(event) {
        if (!event.points || !event.points.length) return;
        const bucket = event.points[0].customdata;
        currentTermBucket = bucket;
        updateTermHistoryView(bucket);
      });
    }

    function updateTermHistoryView(bucket) {
      const histDiv = document.getElementById("term-history-chart");
      const textDiv = document.getElementById("term-history-text");
      if (!histDiv || !textDiv) return;

      const termHist = (termScopeMode === "wing10_20") ? termHistoryWing10_20 : termHistoryAtm10;
      const symHist = termHist[currentSymbol] || {};
      const payload = symHist[bucket];

      if (!payload || !payload.dates || !payload.dates.length) {
        histDiv.innerHTML = "<p></p>";
        textDiv.innerHTML = "<p>暂无可用的历史解读。</p>";
        return;
      }

      const dates = payload.dates || [];
      const priceValues = alignCloseToDates(dates) || (payload.price_values || []);

      const callNet = payload.call_net_values || [];
      const putNet  = payload.put_net_values  || [];

      const callAbs = callNet.map(v => Math.abs(v || 0));
      const putAbs  = putNet.map(v => Math.abs(v || 0));

      const traces = [
        {
          type: "scatter",
          mode: "lines+markers",
          x: dates,
          y: callAbs,
          name: "Call Δ",
          yaxis: "y",
          line: { color: CALL_COLOR },
          marker: { color: CALL_COLOR },
          hovertemplate: "%{x}<br>Call 强度(|净Δ|): %{y:.2e}<extra></extra>",
        },
        {
          type: "scatter",
          mode: "lines+markers",
          x: dates,
          y: putAbs,
          name: "Put Δ",
          yaxis: "y",
          line: { color: PUT_COLOR },
          marker: { color: PUT_COLOR },
          hovertemplate: "%{x}<br>Put 强度(|净Δ|): %{y:.2e}<extra></extra>",
        },
      ];

      if (priceValues && priceValues.length) {
        traces.push({
          type: "scatter",
          mode: "lines",
          x: dates,
          y: priceValues,
          name: currentSymbol + " 收盘价",
          yaxis: "y2",
          line: { color: PRICE_COLOR, width: 2 },
        });
      }

      const layout = applyPlotlyDark({
        margin: { l: 60, r: 50, t: 20, b: 40 },
        xaxis: { title: { text: "交易日" } },
        yaxis: { title: { text: "净 Delta 强度（|净Δ|，Call/Put）" } },
        yaxis2: {
          title: { text: currentSymbol + " 收盘价" },
          overlaying: "y",
          side: "right",
          showgrid: false,
        },
        height: 360,
      });

      Plotly.newPlot(histDiv, traces, layout, { displayModeBar: false });
      textDiv.innerHTML = `<p>${payload.interpret_text_cn || "暂无可用的历史解读。"}</p>`;
    }

    function autoSelectTermBucket() {
      const symData = currentData[currentSymbol];
      const histDiv = document.getElementById("term-history-chart");

      if (!symData) {
        if (histDiv) histDiv.innerHTML = "<p>没有可用的到期桶 Delta 数据。</p>";
        currentTermBucket = null;
        return;
      }

      const atm10Buckets     = symData.term_buckets_atm10 || [];
      const wing10_20Buckets = symData.term_buckets_wing10_20 || [];
      const srcBuckets = (termScopeMode === "wing10_20") ? wing10_20Buckets : atm10Buckets;

      if (!srcBuckets.length) {
        if (histDiv) histDiv.innerHTML = "<p>没有可用的到期桶 Delta 数据。</p>";
        currentTermBucket = null;
        return;
      }

      const arr = srcBuckets.slice().sort((a, b) => {
        const aStrength = (typeof a.metric_abs_sum === "number")
          ? a.metric_abs_sum
          : (Math.abs(a.call_net_sum || 0) + Math.abs(a.put_net_sum || 0));
        const bStrength = (typeof b.metric_abs_sum === "number")
          ? b.metric_abs_sum
          : (Math.abs(b.call_net_sum || 0) + Math.abs(b.put_net_sum || 0));
        return bStrength - aStrength;
      });

      const bucket = arr[0].expiry_bucket;
      currentTermBucket = bucket;
      updateTermHistoryView(bucket);
    }

    function renderTermChangePanel() {
      const panel = document.getElementById("term-change-panel");
      if (!panel) return;

      const changes = (termScopeMode === "wing10_20") ? termChangesWing10_20 : termChangesAtm10;
      const symData = changes[currentSymbol];

      if (!symData) {
        panel.innerHTML = "<p>缺少最近两个交易日的数据，暂无法生成 Top3。</p>";
        return;
      }

      const tradeDate = symData.trade_date || "";
      const prevDate  = symData.prev_date  || "";

      function fmtExp(v) {
        if (typeof v !== "number") return String(v);
        return v.toExponential(2);
      }

      function buildTable(title, rows) {
        rows = Array.isArray(rows) ? rows : [];
        if (!rows.length) return "";
        let html = `<h4>${title}</h4>`;
        html += '<table class="top3-table"><thead><tr><th>到期桶</th><th>变化</th><th>当前</th><th>前一日</th></tr></thead><tbody>';
        rows.forEach(item => {
          const bucket = item.expiry_bucket || "";
          const change = item.change ?? 0;
          const cur    = item.cur ?? 0;
          const prev   = item.prev ?? 0;
          html += `<tr><td>${bucket}</td><td><code>${fmtExp(change)}</code></td><td><code>${fmtExp(cur)}</code></td><td><code>${fmtExp(prev)}</code></td></tr>`;
        });
        html += "</tbody></table>";
        return html;
      }

      const callInc = symData.call_increases || [];
      const callDec = symData.call_decreases || [];
      const putInc  = symData.put_increases  || [];
      const putDec  = symData.put_decreases  || [];

      let html = `<p>比较最近两个交易日 <strong>${prevDate}</strong> → <strong>${tradeDate}</strong> 的到期结构 Delta 变化：</p>`;
      html += '<div class="top3-row">';
      html += `<div class="top3-col">${buildTable("CALL 增加 Top3", callInc)}</div>`;
      html += `<div class="top3-col">${buildTable("CALL 减少 Top3", callDec)}</div>`;
      html += `<div class="top3-col">${buildTable("PUT 增加 Top3",  putInc)}</div>`;
      html += `<div class="top3-col">${buildTable("PUT 减少 Top3",  putDec)}</div>`;
      html += "</div>";

      panel.innerHTML = html;
    }

    function renderSpaceChart() {
      const container = document.getElementById("space-delta-chart");
      if (!container) return;

      const symData = currentData[currentSymbol];
      const rows = getSpaceBucketsForScope(symData);

      if (!symData || !rows || !rows.length) {
        container.innerHTML = "<p>该标的暂无当日价位结构 Call/Put 数据。</p>";
        return;
      }

      const bucketKey = detectBucketKey(rows);

      const buckets = [];
      const callAbs = [];
      const putAbs  = [];

      rows.forEach(row => {
        const bucket = getSpaceBucket(row, bucketKey);
        buckets.push(bucket);

        const ca = (typeof row.call_abs_sum === "number") ? row.call_abs_sum : Math.abs(row.call_net_sum || 0);
        const pa = (typeof row.put_net_sum === "number")  ? Math.abs(row.put_net_sum || 0) : Math.abs(row.put_net_sum_signed || 0);

        callAbs.push(ca);
        putAbs.push(pa);
      });

      const data = [
        {
          type: "bar",
          name: "Call Δ",
          x: buckets,
          y: callAbs,
          customdata: buckets,
          hovertemplate: "价位桶: %{x}<br>Call 强度(|净Δ|): %{y:.2e}<extra></extra>",
          marker: { color: CALL_COLOR },
        },
        {
          type: "bar",
          name: "Put Δ",
          x: buckets,
          y: putAbs,
          customdata: buckets,
          hovertemplate: "价位桶: %{x}<br>Put 强度(|净Δ|): %{y:.2e}<extra></extra>",
          marker: { color: PUT_COLOR },
        },
      ];

      const layout = applyPlotlyDark({
        margin: { l: 60, r: 10, t: 20, b: 60 },
        xaxis: { title: { text: "价位桶（strike 整数）" } },
        yaxis: { title: { text: "Delta 强度（|净Δ|）（Call / Put）" } },
        height: 360,
        barmode: "group",
      });

      Plotly.newPlot(container, data, layout, { displayModeBar: false });

      if (container.removeAllListeners) container.removeAllListeners("plotly_click");
      container.on("plotly_click", function(event) {
        if (!event.points || !event.points.length) return;
        const bucket = event.points[0].customdata;
        currentSpaceBucket = bucket;
        updateSpaceHistoryView(bucket);
      });
    }

    function updateSpaceHistoryView(bucket) {
      try {
        const histDiv = document.getElementById("space-history-chart");
        const textDiv = document.getElementById("space-history-text");
        if (!histDiv || !textDiv) return;

        const spaceHistory = getSpaceHistoryForScope();
        const symHist = spaceHistory[currentSymbol] || {};
        const payload = symHist[bucket];

        if (!payload || !payload.dates || !payload.dates.length) {
          histDiv.innerHTML = "<p></p>";
          textDiv.innerHTML = "<p>暂无可用的历史解读。</p>";
          return;
        }

        const dates = payload.dates || [];
        const n = dates.length;

        function padOrTrim(arr) {
          if (!Array.isArray(arr)) return Array(n).fill(0);
          const res = arr.slice(0, n).map(v => (typeof v === "number" ? v : Number(v) || 0));
          while (res.length < n) res.push(0);
          return res;
        }

        const callAbs = padOrTrim(payload.call_abs_values);
        const putAbs  = padOrTrim(payload.put_abs_values);

        let priceValues = alignCloseToDates(dates);
        if (!priceValues && Array.isArray(payload.price_values) && payload.price_values.length) {
          priceValues = payload.price_values.slice(0, n).map(v => (v == null ? null : Number(v)));
          while (priceValues.length < n) priceValues.push(null);
        }

        const traces = [
          {
            type: "scatter",
            mode: "lines+markers",
            x: dates,
            y: callAbs,
            name: "Call Δ",
            yaxis: "y",
            line: { color: CALL_COLOR },
            marker: { color: CALL_COLOR },
            hovertemplate: "%{x}<br>Call 强度(|净Δ|): %{y:.2e}<extra></extra>",
          },
          {
            type: "scatter",
            mode: "lines+markers",
            x: dates,
            y: putAbs,
            name: "Put Δ",
            yaxis: "y",
            line: { color: PUT_COLOR },
            marker: { color: PUT_COLOR },
            hovertemplate: "%{x}<br>Put 强度(|净Δ|): %{y:.2e}<extra></extra>",
          },
        ];

        if (priceValues && priceValues.length) {
          traces.push({
            type: "scatter",
            mode: "lines",
            x: dates,
            y: priceValues,
            name: currentSymbol + " 收盘价",
            yaxis: "y2",
            line: { color: PRICE_COLOR, width: 2 },
          });
        }

        const layout = applyPlotlyDark({
          margin: { l: 60, r: 50, t: 20, b: 40 },
          xaxis: { title: { text: "交易日" } },
          yaxis: { title: { text: "净 Delta 强度（|净Δ|，Call / Put）" } },
          yaxis2: {
            title: { text: currentSymbol + " 收盘价" },
            overlaying: "y",
            side: "right",
            showgrid: false,
          },
          height: 360,
        });

        Plotly.newPlot(histDiv, traces, layout, { displayModeBar: false });

        const interpret = payload.interpret_text_cn || "该价位桶在最近一段时间的 Call/Put 结构如上图所示。";
        textDiv.innerHTML = `<p>${interpret}</p>`;
      } catch (e) {
        console.error(e);
        const textDiv = document.getElementById("space-history-text");
        if (textDiv) textDiv.innerHTML = `<p>空间历史渲染出错：${String(e)}</p>`;
      }
    }

    function autoSelectSpaceBucket() {
      const symData = currentData[currentSymbol];
      const histDiv = document.getElementById("space-history-chart");

      const rows = getSpaceBucketsForScope(symData);
      if (!symData || !rows || !rows.length) {
        if (histDiv) histDiv.innerHTML = "<p>没有可用的价位桶 Call/Put 数据。</p>";
        currentSpaceBucket = null;
        return;
      }

      const bucketKey = detectBucketKey(rows);
      const arr = rows.slice().sort((a, b) => getSpaceRankValue(b) - getSpaceRankValue(a));
      const bucket = getSpaceBucket(arr[0], bucketKey);

      currentSpaceBucket = bucket;
      updateSpaceHistoryView(bucket);
    }

    function renderSpaceChangePanel() {
      const panel = document.getElementById("space-change-panel");
      if (!panel) return;

      const spaceChanges = getSpaceChangesForScope();
      const symData = spaceChanges[currentSymbol];

      if (!symData) {
        panel.innerHTML = "<p>缺少最近两个交易日的数据，暂无法生成 Top3。</p>";
        return;
      }

      const tradeDate = symData.trade_date || "";
      const prevDate  = symData.prev_date  || "";

      function fmtExp(v) {
        if (typeof v !== "number") return String(v);
        return v.toExponential(2);
      }

      function buildTable(title, rows) {
        rows = Array.isArray(rows) ? rows : [];
        if (!rows.length) return "";
        let html = `<h4>${title}</h4>`;
        html += '<table class="top3-table"><thead><tr><th>价位桶</th><th>变化</th><th>当前</th><th>前一日</th></tr></thead><tbody>';
        rows.forEach(item => {
          const bucket = item.strike_bucket || "";
          const change = item.change ?? 0;
          const cur    = item.cur ?? 0;
          const prev   = item.prev ?? 0;
          html += `<tr><td>${bucket}</td><td><code>${fmtExp(change)}</code></td><td><code>${fmtExp(cur)}</code></td><td><code>${fmtExp(prev)}</code></td></tr>`;
        });
        html += "</tbody></table>";
        return html;
      }

      const callInc = symData.call_increases || [];
      const callDec = symData.call_decreases || [];
      const putInc  = symData.put_increases  || [];
      const putDec  = symData.put_decreases  || [];

      let html = `<p>比较最近两个交易日 <strong>${prevDate}</strong> → <strong>${tradeDate}</strong> 的价位结构 Delta 变化：</p>`;
      html += '<div class="top3-row">';
      html += `<div class="top3-col">${buildTable("CALL 增加 Top3", callInc)}</div>`;
      html += `<div class="top3-col">${buildTable("CALL 减少 Top3", callDec)}</div>`;
      html += `<div class="top3-col">${buildTable("PUT 增加 Top3",  putInc)}</div>`;
      html += `<div class="top3-col">${buildTable("PUT 减少 Top3",  putDec)}</div>`;
      html += "</div>";

      panel.innerHTML = html;
    }

    function setupToggles() {
      document.querySelectorAll('input[name="space-scope-mode"]').forEach(r => {
        r.addEventListener("change", function() {
          if (!this.checked) return;
          spaceScopeMode = this.value || "dte_1_30";
          renderSpaceChart();
          autoSelectSpaceBucket();
          renderSpaceChangePanel();
        });
      });

      document.querySelectorAll('input[name="term-scope-mode"]').forEach(r => {
        r.addEventListener("change", function() {
          if (!this.checked) return;
          termScopeMode = (this.value === "wing10_20") ? "wing10_20" : "atm10";
          renderTermChart();
          autoSelectTermBucket();
          renderTermChangePanel();
        });
      });
    }

    document.addEventListener("DOMContentLoaded", function() {
      if (!symbols.length) {
        document.body.innerHTML = '<p style="text-align:center;margin-top:40px;">当前没有可用的 Delta 数据。</p>';
        return;
      }
      renderSymbolOptions();
      setupToggles();
      renderGlobalSummary();
      renderTermChart();
      autoSelectTermBucket();
      renderSpaceChart();
      autoSelectSpaceBucket();
      renderTermChangePanel();
      renderSpaceChangePanel();
    });
  })();
  </script>
</body>
</html>
